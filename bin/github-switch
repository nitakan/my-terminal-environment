#!/bin/zsh

# GitHub CLI account switcher with git config
# Requires: gh (GitHub CLI), fzf

# ログイン済みのGitHubアカウントを取得
accounts=($(gh auth status 2>&1 | grep "Logged in" | sed -n 's/.*account \([^ ]*\) .*/\1/p'))

# アカウントが取得できているか確認
if [ ${#accounts[@]} -eq 0 ]; then
    echo "No GitHub accounts found. Make sure you're logged in to GitHub CLI."
    echo "Run: gh auth login"
    exit 1
fi

# fzfでアカウントを選択
selected_account=$(printf '%s\n' "${accounts[@]}" | fzf --prompt="Select GitHub account to switch to: " --height=20% --border)

# 選択されたアカウントに切り替え
if [[ -n "$selected_account" ]]; then
    gh auth switch -u "$selected_account"
    echo "Switched GitHub CLI to: $selected_account"

    # TODO: カスタマイズ - 必要に応じてgit configも更新
    # case "$selected_account" in
    #     "your-github-username")
    #         git config --global user.name "Your Name"
    #         git config --global user.email "your.email@example.com"
    #         ;;
    #     "another-username")
    #         git config --global user.name "Another Name"
    #         git config --global user.email "another@example.com"
    #         ;;
    # esac
fi
