#!/bin/zsh

# GitHub CLI account switcher with git config
# Requires: gh (GitHub CLI), fzf

# ログイン済みのGitHubアカウントを取得
accounts=($(gh auth status 2>&1 | grep "Logged in" | sed -n 's/.*account \([^ ]*\) .*/\1/p'))

# アカウントが取得できているか確認
if [ ${#accounts[@]} -eq 0 ]; then
    echo "No GitHub accounts found. Make sure you're logged in to GitHub CLI."
    echo "Run: gh auth login"
    exit 1
fi

# fzfでアカウントを選択
selected_account=$(printf '%s\n' "${accounts[@]}" | fzf --prompt="Select GitHub account to switch to: " --height=20% --border)

# 選択されたアカウントに切り替え
if [[ -n "$selected_account" ]]; then
    gh auth switch -u "$selected_account"
    echo "Switched GitHub CLI to: $selected_account"

    # SSH鍵を切り替え
    case "$selected_account" in
        "nitakan")
            cp ~/.ssh/id_rsa_nitakan ~/.ssh/id_rsa_current
            cp ~/.ssh/id_rsa_nitakan.pub ~/.ssh/id_rsa_current.pub
            echo "Switched SSH key to: nitakan"
            ;;
        "yzrh-mkato")
            cp ~/.ssh/id_rsa_yzrh ~/.ssh/id_rsa_current
            cp ~/.ssh/id_rsa_yzrh.pub ~/.ssh/id_rsa_current.pub
            echo "Switched SSH key to: yzrh-mkato (yzrh)"
            ;;
    esac
fi
